function splitFilters(filterString) {
  function splitRecursive(filter) {
    const featureFilters = [];
    const contextFilters = [];

    // Helper to determine if the condition is a feature filter
    const isFeatureFilter = (condition) =>
      condition[1] && Array.isArray(condition[1]) && condition[1][0] === 'get';

    // Process filters recursively
    if (Array.isArray(filter)) {
      const [logic, ...conditions] = filter;

      if (logic === 'all' || logic === 'any') {
        const localFeatureFilters = [];
        const localContextFilters = [];

        for (const condition of conditions) {
          const [ff, cf] = splitRecursive(condition);
          localFeatureFilters.push(...ff);
          localContextFilters.push(...cf);
        }

        if (localFeatureFilters.length) featureFilters.push([logic, ...localFeatureFilters]);
        if (localContextFilters.length) contextFilters.push([logic, ...localContextFilters]);
      } else {
        (isFeatureFilter(filter) ? featureFilters : contextFilters).push(filter);
      }
    }

    return [featureFilters, contextFilters];
  }

  // Recurse to split the filters
  const [featureFilters, contextFilters] = splitRecursive(filterString);

  const simplify = (filters) => (filters.length === 1 ? filters[0] : filters);

  return {
    featureFilters: simplify(featureFilters),
    contextFilters: simplify(contextFilters),
  };
}

//////////

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Filter Splitter Test</title>
  <script>
    function splitFilters(filterString) {
      function splitRecursive(filter) {
        const featureFilters = [];
        const contextFilters = [];

        // Helper to determine if the condition is a feature filter
        const isFeatureFilter = (condition) => {
          return condition[1] && Array.isArray(condition[1]) && condition[1][0] === 'get';
        };

        // Process filters recursively
        if (Array.isArray(filter)) {
          const [logic, ...conditions] = filter;

          if (logic === 'all' || logic === 'any') {
            const localFeatureFilters = [];
            const localContextFilters = [];

            conditions.forEach((condition) => {
              const [ff, cf] = splitRecursive(condition);
              localFeatureFilters.push(...ff);
              localContextFilters.push(...cf);
            });

            if (localFeatureFilters.length > 0) {
              featureFilters.push([logic, ...localFeatureFilters]);
            }
            if (localContextFilters.length > 0) {
              contextFilters.push([logic, ...localContextFilters]);
            }
          } else {
            if (isFeatureFilter(filter)) {
              featureFilters.push(filter);
            } else {
              contextFilters.push(filter);
            }
          }
        }

        return [featureFilters, contextFilters];
      }

      // Recurse to split the filters
      const [featureFilters, contextFilters] = splitRecursive(filterString);

      return {
        featureFilters: featureFilters.length === 1 ? featureFilters[0] : featureFilters,
        contextFilters: contextFilters.length === 1 ? contextFilters[0] : contextFilters,
      };
    }

    function testSplitFilters() {
      const filterString = [
        'all',
        ["in", ["get", "class"], ["literal", ["lake", "river"]]],
        ["==", ["get", "layer"], "waterway"],
        ['any', ['<', ['zoom'], 5], ['>', ['zoom'], 10]],
        ["==", ["geometry-type"], "Polygon"],
        ['>', ['resolution'], 10]
      ];

      const result = splitFilters(filterString);

      document.getElementById('featureFilters').textContent = JSON.stringify(result.featureFilters, null, 2);
      document.getElementById('contextFilters').textContent = JSON.stringify(result.contextFilters, null, 2);
    }
  </script>
</head>
<body>
  <h1>Filter Splitter Test</h1>
  <button onclick="testSplitFilters()">Run Test</button>
  <h2>Feature Filters:</h2>
  <pre id="featureFilters"></pre>
  <h2>Context Filters:</h2>
  <pre id="contextFilters"></pre>
</body>
</html>
