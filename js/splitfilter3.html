function splitFilters(filters) {
  const classifyFilters = (expression) => {
    if (!Array.isArray(expression)) return [[], []];

    const [operator, ...values] = expression;

    if (['all', 'any', '!'].includes(operator)) {
      const featureFilters = [];
      const contextFilters = [];

      values.forEach((value) => {
        const [ff, cf] = classifyFilters(value);
        featureFilters.push(...ff);
        contextFilters.push(...cf);
      });

      // operator로 체크할 수를 계산
      const checkLength = operator === 'all' || operator === 'any' ? 1 : 0;

      return [
        featureFilters.length > checkLength ? [[operator, ...featureFilters]] : featureFilters,
        contextFilters.length > checkLength ? [[operator, ...contextFilters]] : contextFilters,
      ];
    }

    const isFeatureFilter = Array.isArray(expression[1]) && expression[1][0] === 'get';
    return isFeatureFilter ? [[expression], []] : [[], [expression]];
  };

  const [featureFilters, contextFilters] = classifyFilters(filters);

  return {
    featureFilters: featureFilters.length > 1 ? featureFilters : featureFilters[0],
    contextFilters: contextFilters.length > 1 ? contextFilters : contextFilters[0],
  };
}
//////////
function splitFilters(filters) {
  const classifyFilters = (expression) => {
    if (!Array.isArray(expression)) return [[], []];

    const [operator, ...values] = expression;

    const featureFilters = [];
    const contextFilters = [];

    values.forEach((value) => {
      const [ff, cf] = classifyFilters(value);
      featureFilters.push(...ff);
      contextFilters.push(...cf);
    });

    const shouldGroup = ['all', 'any'].includes(operator) && featureFilters.length > 1;

    return [
      shouldGroup ? [[operator, ...featureFilters]] : featureFilters,
      shouldGroup ? [[operator, ...contextFilters]] : contextFilters,
    ];
  };

  const [featureFilters, contextFilters] = classifyFilters(filters);

  return {
    featureFilters: featureFilters.length === 1 ? featureFilters[0] : featureFilters,
    contextFilters: contextFilters.length === 1 ? contextFilters[0] : contextFilters,
  };
}

// 테스트 데이터
const filterString = [
  'all',
  ["in", ["get", "class"], ["literal", ["lake", "river"]]],
  ["!", ["in", ["get", "class"], ["literal", ["lake", "river"]]]],
  ["==", ["get", "layer"], "waterway"],
  ['any', ['<', ['zoom'], 5], ['>', ['zoom'], 10]],
  ["==", ["geometry-type"], "Polygon"],
  ['>', ['resolution'], 10],
];

// 실행 결과
console.log(splitFilters(filterString));
//////////
function splitFilters(filters) {
  const classifyFilters = (expression) => {
    if (!Array.isArray(expression)) return [[], []];

    const [operator, ...values] = expression;

    if (['all', 'any', '!'].includes(operator)) {
      const featureFilters = [];
      const contextFilters = [];

      values.forEach((value) => {
        const [ff, cf] = classifyFilters(value);
        featureFilters.push(...ff);
        contextFilters.push(...cf);
      });

      if(operator === 'all' || operator === 'any') {
      {
        return [
          featureFilters.length > 1 ? [[operator, ...featureFilters]] : featureFilters,
          contextFilters.length > 1 ? [[operator, ...contextFilters]] : contextFilters,
        ];
      }
      return [
        featureFilters.length > 0 ? [[operator, ...featureFilters]] : featureFilters,
        contextFilters.length > 0 ? [[operator, ...contextFilters]] : contextFilters,
      ];
    }

    const isFeatureFilter = Array.isArray(expression[1]) && expression[1][0] === 'get';
    return isFeatureFilter ? [[expression], []] : [[], [expression]];
  };

  const [featureFilters, contextFilters] = classifyFilters(filters);

  return {
    featureFilters: featureFilters.length === 1 ? featureFilters[0] : featureFilters,
    contextFilters: contextFilters.length === 1 ? contextFilters[0] : contextFilters,
  };
}

////////////////
function splitFilters(filters) {
  const classifyFilters = (expression) => {
    if (!Array.isArray(expression)) return [[], []];

    const [operator, ...values] = expression;

    // Recursively handle logical operators
    if (['all', 'any', '!'].includes(operator)) {
      const featureFilters = [];
      const contextFilters = [];

      values.forEach((value) => {
        const [ff, cf] = classifyFilters(value);
        featureFilters.push(...ff);
        contextFilters.push(...cf);
      });

      return [
        featureFilters.length > 1 || operator === '!' ? [[operator, ...featureFilters]] : featureFilters,
        contextFilters.length > 1 || operator === '!' ? [[operator, ...contextFilters]] : contextFilters,
      ];
    }

    // Check if it's a feature filter
    const isFeatureFilter = Array.isArray(expression[1]) && expression[1][0] === 'get';
    return isFeatureFilter ? [[expression], []] : [[], [expression]];
  };

  const [featureFilters, contextFilters] = classifyFilters(filters);

  return {
    featureFilters: featureFilters.length === 1 ? featureFilters[0] : featureFilters,
    contextFilters: contextFilters.length === 1 ? contextFilters[0] : contextFilters,
  };
}
////

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Filter Splitter Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    textarea {
      width: 100%;
      height: 150px;
    }
    button {
      padding: 10px 20px;
      margin-top: 10px;
      cursor: pointer;
    }
  </style>
  <script>
  function splitFilters(filters) {
  
    const classifyFilters = (expression) => {
      if (!Array.isArray(expression)) return [[], []];
  
      const [operator, ...values] = expression;
  
      if (operator === 'all' || operator === 'any') {
        const featureFilters = [];
        const contextFilters = [];
  
        values.forEach((value) => {
          const [ff, cf] = classifyFilters(value);
          featureFilters.push(...ff);
          contextFilters.push(...cf);
        });
  
        return [
          featureFilters.length > 1 ? [[operator, ...featureFilters]] : featureFilters,
          contextFilters.length > 1 ? [[operator, ...contextFilters]] : contextFilters,
        ];
      }
  
      const isFeatureFilter = expression[1] && Array.isArray(expression[1]) && expression[1][0] === 'get';
      return isFeatureFilter ? [[expression], []] : [[], [expression]];
    };
  
    const [featureFilters, contextFilters] = classifyFilters(filters);
  
    return {
        featureFilters: featureFilters.length === 1 ? featureFilters[0] : featureFilters,
        contextFilters: contextFilters.length === 1 ? contextFilters[0] : contextFilters,
    };
  }

    function testSplitFilters() {
/////////////////
      const input = document.getElementById('filterInput').value;
      try {
        const filterArray = JSON.parse(input.replace(/'/g, '"'));
        const { static, dynamic } = splitFilters(filterArray);
        const result = splitFilters(filterArray);

        document.getElementById('featureFilters').textContent = JSON.stringify(result.featureFilters, null, 2);
        document.getElementById('contextFilters').textContent = JSON.stringify(result.contextFilters, null, 2);
        
      } catch (error) {
        alert('Invalid JSON input! Please check your filter string.');
      }
////////////////////

/*
      const filterString = [
        'all',
        ["in", ["get", "class"], ["literal", ["lake", "river"]]],
        ["!", ["in", ["get", "class"], ["literal", ["lake", "river"]]]],
        ["==", ["get", "layer"], "waterway"],
        ['any', ['<', ['zoom'], 5], ['>', ['zoom'], 10]],
        ["==", ["geometry-type"], "Polygon"],
        ['>', ['resolution'], 10]
      ];
      */
    }
  </script>
</head>
<body>
  <h1>Filter Splitter Test</h1>
  <textarea id="filterInput">[
    "all",
    ["<", ["resolution"], 600],
    ["in", ["get", "class"], ["literal", ["lake", "river"]]],
    ["==", ["get", "layer"], "waterway"],
    ["==", ["geometry-type"], "Polygon"]
  ]</textarea>  
  <button onclick="testSplitFilters()">Run Test</button>
  <h2>Feature Filters:</h2>
  <pre id="featureFilters"></pre>
  <h2>Context Filters:</h2>
  <pre id="contextFilters"></pre>
</body>
</html>
