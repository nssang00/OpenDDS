function splitFilters(filterString) {
  const featureFilters = [];
  const contextFilters = [];

  // Helper to determine if the condition is a feature filter
  const isFeatureFilter = (value) => {
    return value[1] && Array.isArray(value[1]) && value[1][0] === 'get';
  };

  function classifyFilters(expression) {
    if (!Array.isArray(expression)) return;

    const [operator, ...values] = expression;

    if (operator === 'all' || operator === 'any') {
      // 재귀적으로 하위 필터 분리
      const groupedFeatureFilters = [];
      const groupedContextFilters = [];

      values.forEach((value) => {
        const [ff, cf] = classifyFilters(value);
        groupedFeatureFilters.push(...ff);
        groupedContextFilters.push(...cf);
      });

      // operator를 포함하여 추가
      if (groupedFeatureFilters.length > 0) {
        featureFilters.push([operator, ...groupedFeatureFilters]);
      }
      if (groupedContextFilters.length > 0) {
        contextFilters.push([operator, ...groupedContextFilters]);
      }
    } else {
      // 일반적인 경우 바로 분류 후 추가
      (isFeatureFilter(expression) ? featureFilters : contextFilters).push(expression);
    }

    return [featureFilters, contextFilters]; // 재귀 호출 결과 반환
  }

  classifyFilters(filterString);

  return {
    featureFilters: featureFilters.length === 1 ? featureFilters[0] : featureFilters,
    contextFilters: contextFilters.length === 1 ? contextFilters[0] : contextFilters,
  };
}

//////

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Filter Splitter Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    textarea {
      width: 100%;
      height: 150px;
    }
    button {
      padding: 10px 20px;
      margin-top: 10px;
      cursor: pointer;
    }
  </style>
  <script>
    function splitFilters(filterString) {
      function classifyFilters(expression) {
        const featureFilters = [];
        const contextFilters = [];

        // Helper to determine if the condition is a feature filter
        const isFeatureFilter = (value) => {
          return value[1] && Array.isArray(value[1]) && value[1][0] === 'get';
        };

        if (Array.isArray(expression)) {
          const [operator, ...values] = expression;

          if (operator === 'all' || operator === 'any') {
            const resultFeatureFilters = [];
            const resultContextFilters = [];

            values.forEach((value) => {
              const [ff, cf] = classifyFilters(value);
              resultFeatureFilters.push(...ff);
              resultContextFilters.push(...cf);
            });

            if (resultFeatureFilters.length > 0) {
              featureFilters.push([operator, ...resultFeatureFilters]);
            }
            if (resultContextFilters.length > 0) {
              contextFilters.push([operator, ...resultContextFilters]);
            }
          } else {
            (isFeatureFilter(expression) ? featureFilters : contextFilters).push(expression);
          }
        }

        return [featureFilters, contextFilters];
      }

      const [featureFilters, contextFilters] = classifyFilters(filterString);

      return {
        featureFilters: featureFilters.length === 1 ? featureFilters[0] : featureFilters,
        contextFilters: contextFilters.length === 1 ? contextFilters[0] : contextFilters,
      };
    }

    function testSplitFilters() {
/////////////////
      const input = document.getElementById('filterInput').value;
      try {
        const filterArray = JSON.parse(input);
        const { static, dynamic } = splitFilters(filterArray);
        const result = splitFilters(filterArray);

document.getElementById('featureFilters').textContent = JSON.stringify(result.featureFilters, null, 2);
document.getElementById('contextFilters').textContent = JSON.stringify(result.contextFilters, null, 2);
        
      } catch (error) {
        alert('Invalid JSON input! Please check your filter string.');
      }
////////////////////

/*
      const filterString = [
        'all',
        ["in", ["get", "class"], ["literal", ["lake", "river"]]],
        ["==", ["get", "layer"], "waterway"],
        ['any', ['<', ['zoom'], 5], ['>', ['zoom'], 10]],
        ["==", ["geometry-type"], "Polygon"],
        ['>', ['resolution'], 10]
      ];

      const result = splitFilters(filterString);

      document.getElementById('featureFilters').textContent = JSON.stringify(result.featureFilters, null, 2);
      document.getElementById('contextFilters').textContent = JSON.stringify(result.contextFilters, null, 2);
      */
    }
  </script>
</head>
<body>
  <h1>Filter Splitter Test</h1>
  <textarea id="filterInput">[
    "all",
    ["<", ["resolution"], 600],
    ["in", ["get", "class"], ["literal", ["lake", "river"]]],
    ["==", ["get", "layer"], "waterway"],
    ["==", ["geometry-type"], "Polygon"]
  ]</textarea>  
  <button onclick="testSplitFilters()">Run Test</button>
  <h2>Feature Filters:</h2>
  <pre id="featureFilters"></pre>
  <h2>Context Filters:</h2>
  <pre id="contextFilters"></pre>
</body>
</html>
