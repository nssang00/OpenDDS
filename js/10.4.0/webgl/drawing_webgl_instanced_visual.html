<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>두께 라인 내부 반투명 색칠</title>
  <style>
    body { background: #161822; margin:0; font-family:'Pretendard',sans-serif; }
    .container { width:1100px; margin:32px auto 0 auto; }
    .viz-box { background:#232846; border-radius:14px; padding:20px 0 10px 0; margin-bottom:18px; }
    .tbl-box { background:#1a2033; border-radius:10px; margin:0 0 22px 0; color:#fff; padding:18px 0 10px 0; }
    table { border-collapse:collapse; margin:0 auto; width:1000px;}
    th, td { border:1.3px solid #33405e; padding:7px 13px; font-size:1.07em;}
    th { background:#244072; color:#a3e0ff;}
    td { background:#232846;}
    .inst0 { background:#24386f !important; }
    .inst1 { background:#5b358e !important; }
    .head { color:#ffe058; font-size:1.13em; }
    .info { color:#8cf7ff; font-size:1.03em; margin:7px 0 0 32px; }
    .desc { margin:14px 0 10px 0; color:#ffd371; font-size:1.07em;}
    canvas { display:block; margin:0 auto 0 auto; border-radius:13px;}
  </style>
</head>
<body>
  <div class="container">
    <div class="desc">
      <b>각 두께 라인(사각형) 내부를 <span style="color:#ffe058">인스턴스 색상 반투명</span>으로 채워서<br>
        WebGL 실제 렌더링과 유사하게 시각화 (<span style="color:#ffd600">테두리와 정점·라벨은 동일</span>)
      </b>
    </div>
    <div class="viz-box">
      <canvas id="sixviz" width="1040" height="470"></canvas>
      <div class="info">
        <span style="color:#5ab4ff;font-weight:bold;">● a_segmentStart, a_segmentEnd: 인스턴스0 파랑, 인스턴스1 보라</span>
        <span style="color:#ffe058;">｜</span>
        <span style="color:#e6e6fa;">작은 반투명 원: 쿼드 4정점(Q0~Q3)</span>
        <span style="color:#ffe058;">｜</span>
        <span style="color:#ffd600;">사각형 내부와 테두리: 두께 라인(반투명+얇은색)</span>
        <br>
        <span style="color:#5ab4ff">■ 인스턴스 0 (점1-점2)</span>,
        <span style="color:#ad6cf6">■ 인스턴스 1 (점2-점3)</span>
      </div>
    </div>
    <div class="tbl-box">
      <div class="head">각 인스턴스(선분) 별 6개 vertex attribute (삼각형 2개, 6정점)</div>
      <table>
        <tr>
          <th>인스턴스</th>
          <th>삼각형</th>
          <th>인덱스</th>
          <th>a_position</th>
          <th>a_segmentStart</th>
          <th>a_segmentEnd</th>
          <th>a_joinAngles</th>
        </tr>
        <!-- 인스턴스 0: 1-2 -->
        <tr class="inst0"><td rowspan="6" style="font-weight:bold;text-align:center;background:#24386f;color:#a3e0ff;">0</td>
          <td>삼각형1</td><td>0</td><td>[-1,-1]</td><td>(220,160)</td><td>(540,290)</td><td>(0.0,0.22)</td></tr>
        <tr class="inst0"><td>삼각형1</td><td>1</td><td>[-1, 1]</td><td>(220,160)</td><td>(540,290)</td><td>(0.0,0.22)</td></tr>
        <tr class="inst0"><td>삼각형1</td><td>2</td><td>[ 1,-1]</td><td>(220,160)</td><td>(540,290)</td><td>(0.0,0.22)</td></tr>
        <tr class="inst0"><td>삼각형2</td><td>1</td><td>[-1, 1]</td><td>(220,160)</td><td>(540,290)</td><td>(0.0,0.22)</td></tr>
        <tr class="inst0"><td>삼각형2</td><td>3</td><td>[ 1, 1]</td><td>(220,160)</td><td>(540,290)</td><td>(0.0,0.22)</td></tr>
        <tr class="inst0"><td>삼각형2</td><td>2</td><td>[ 1,-1]</td><td>(220,160)</td><td>(540,290)</td><td>(0.0,0.22)</td></tr>
        <!-- 인스턴스 1: 2-3 -->
        <tr class="inst1"><td rowspan="6" style="font-weight:bold;text-align:center;background:#5b358e;color:#fff;">1</td>
          <td>삼각형1</td><td>0</td><td>[-1,-1]</td><td>(540,290)</td><td>(840,180)</td><td>(-0.22,0.0)</td></tr>
        <tr class="inst1"><td>삼각형1</td><td>1</td><td>[-1, 1]</td><td>(540,290)</td><td>(840,180)</td><td>(-0.22,0.0)</td></tr>
        <tr class="inst1"><td>삼각형1</td><td>2</td><td>[ 1,-1]</td><td>(540,290)</td><td>(840,180)</td><td>(-0.22,0.0)</td></tr>
        <tr class="inst1"><td>삼각형2</td><td>1</td><td>[-1, 1]</td><td>(540,290)</td><td>(840,180)</td><td>(-0.22,0.0)</td></tr>
        <tr class="inst1"><td>삼각형2</td><td>3</td><td>[ 1, 1]</td><td>(540,290)</td><td>(840,180)</td><td>(-0.22,0.0)</td></tr>
        <tr class="inst1"><td>삼각형2</td><td>2</td><td>[ 1,-1]</td><td>(540,290)</td><td>(840,180)</td><td>(-0.22,0.0)</td></tr>
      </table>
      <div class="desc">※ 위의 시각화 선/점 색상 = 이 표 인스턴스 배경색 계열과 1:1 일치!</div>
    </div>
  </div>
  <script>
    const ctx = document.getElementById("sixviz").getContext("2d");
    // 점 3개
    const P1 = {x:220, y:160}, P2={x:540, y:290}, P3={x:840, y:180};
    // 색상(테이블 배경과 일치)
    const instColors = [
      { main: "#5ab4ff", mainAlpha: "rgba(90,180,255,0.32)", sub:"#cdefff", quad:"#e6e6fa", quadAlpha:"rgba(230,230,250,0.45)", tbl:"#24386f" },
      { main: "#ad6cf6", mainAlpha: "rgba(173,108,246,0.32)", sub:"#f0e6ff", quad:"#e6e6fa", quadAlpha:"rgba(230,230,250,0.45)", tbl:"#5b358e" }
    ];
    // 두 인스턴스(선분)
    const lines = [
      { A: P1, B: P2, color: instColors[0], join: "(0.0,0.22)" },
      { A: P2, B: P3, color: instColors[1], join: "(-0.22,0.0)" }
    ];
    const thickness = 60;
    function quadVerts(line) {
      const {A,B} = line;
      const dx=B.x-A.x, dy=B.y-A.y, len=Math.sqrt(dx*dx+dy*dy);
      const nx=-dy/len, ny=dx/len;
      const ox=nx*thickness/2, oy=ny*thickness/2;
      return [
        { x:A.x+ox, y:A.y+oy },
        { x:B.x+ox, y:B.y+oy },
        { x:B.x-ox, y:B.y-oy },
        { x:A.x-ox, y:A.y-oy }
      ];
    }
    // 배경
    ctx.save();
    ctx.globalAlpha = 0.10;
    ctx.fillStyle = "#49f";
    ctx.fillRect(44, 46, 950, 352);
    ctx.restore();
    ctx.font = "bold 19px sans-serif";
    ctx.fillStyle = "#fff";
    ctx.fillText("가운데 중심선 없이, 표 색상과 일치하는 두께 라인(사각형)만 시각화",80,74);

    // 점1,2,3 (중앙에 작은 반투명 원)
    [P1,P2,P3].forEach((pt,i)=>{
      ctx.save();
      ctx.beginPath();
      ctx.arc(pt.x, pt.y, 7.5, 0, 2*Math.PI);
      ctx.fillStyle = i==0 ? instColors[0].mainAlpha : (i==2?instColors[1].mainAlpha:"rgba(179,230,255,0.32)");
      ctx.fill();
      ctx.lineWidth = 2;
      ctx.strokeStyle = "#fff";
      ctx.stroke();
      ctx.font = "bold 12px sans-serif";
      ctx.fillStyle = "#232846";
      ctx.fillText(i===0?"점1":i===1?"점2":"점3", pt.x-11, pt.y-14);
      ctx.font = "bold 10px sans-serif";
      ctx.fillStyle = "#fff";
      ctx.fillText(`(${pt.x},${pt.y})`, pt.x-14, pt.y+16);
      ctx.restore();
    });

    lines.forEach((line,instIdx)=>{
      const A = line.A, B = line.B;
      const quad = quadVerts(line);

      // 두께 라인(사각형) 내부 반투명 채움
      ctx.save();
      ctx.globalAlpha = 1;
      ctx.beginPath();
      ctx.moveTo(quad[0].x, quad[0].y);
      ctx.lineTo(quad[1].x, quad[1].y);
      ctx.lineTo(quad[2].x, quad[2].y);
      ctx.lineTo(quad[3].x, quad[3].y);
      ctx.closePath();
      ctx.fillStyle = line.color.mainAlpha;
      ctx.fill();
      ctx.restore();

      // 두께 라인(사각형) 테두리만 얇게
      ctx.save();
      ctx.beginPath();
      ctx.moveTo(quad[0].x, quad[0].y);
      ctx.lineTo(quad[1].x, quad[1].y);
      ctx.lineTo(quad[2].x, quad[2].y);
      ctx.lineTo(quad[3].x, quad[3].y);
      ctx.closePath();
      ctx.globalAlpha = 0.5;
      ctx.lineWidth = 3.2;
      ctx.strokeStyle = line.color.main;
      ctx.stroke();
      ctx.restore();

      // 쿼드 4정점 (연하고 작게, 반투명)
      for(let i=0; i<4; ++i) {
        ctx.save();
        ctx.globalAlpha = 1;
        ctx.beginPath();
        ctx.arc(quad[i].x, quad[i].y, 4.5, 0, 2*Math.PI);
        ctx.fillStyle = line.color.mainAlpha;
        ctx.fill();
        ctx.lineWidth = 1;
        ctx.strokeStyle = "#fff";
        ctx.stroke();
        ctx.font = "bold 9px sans-serif";
        ctx.fillStyle = line.color.main;
        ctx.fillText(`Q${i}`, quad[i].x-7, quad[i].y-7);
        ctx.restore();
      }

      // segmentStart/End 라벨
      [A,B].forEach((pt,pi)=>{
        ctx.save();
        ctx.font = "bold 10px sans-serif";
        ctx.fillStyle = line.color.main;
        ctx.fillText(pi==0?"a_segmentStart":"a_segmentEnd", pt.x+10, pt.y-7+pi*16);
        ctx.restore();
      });
    });
    ctx.font = "bold 13px sans-serif";
    ctx.fillStyle = "#ff9";
    ctx.fillText("작은 반투명 원, 사각형: 테이블 각 인스턴스 색상과 정확히 일치",72,410);
    ctx.font = "bold 12px sans-serif";
    ctx.fillStyle = "#ffe058";
    ctx.fillText("Q0~Q3: 쿼드 4꼭짓점(연노랑), Q0→Q1→Q2→Q3→Q0로 얇은 사각형",72,428);
  </script>
</body>
</html>
