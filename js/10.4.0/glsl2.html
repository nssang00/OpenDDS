<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebGL GeoJSON Visualization</title>
  <style>
    canvas {
      border: 1px solid black;
    }
  </style>
</head>
<body>
  <canvas id="webglCanvas" width="600" height="600"></canvas>

  <script>
    // WebGL 컨텍스트 초기화
    const canvas = document.getElementById('webglCanvas');
    const gl = canvas.getContext('webgl');

    if (!gl) {
      alert("WebGL을 지원하지 않는 브라우저입니다.");
    }

    // 셰이더 프로그램 작성
    const vertexShaderSource = `
      attribute vec4 a_position;
      void main() {
        gl_Position = a_position;
      }
    `;
    const fragmentShaderSource = `
      precision mediump float;
      uniform vec4 u_color;
      void main() {
        gl_FragColor = u_color;
      }
    `;

    // 셰이더 컴파일
    const vertexShader = gl.createShader(gl.VERTEX_SHADER);
    gl.shaderSource(vertexShader, vertexShaderSource);
    gl.compileShader(vertexShader);

    const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
    gl.shaderSource(fragmentShader, fragmentShaderSource);
    gl.compileShader(fragmentShader);

    // 프로그램 생성
    const shaderProgram = gl.createProgram();
    gl.attachShader(shaderProgram, vertexShader);
    gl.attachShader(shaderProgram, fragmentShader);
    gl.linkProgram(shaderProgram);
    gl.useProgram(shaderProgram);

    // 위치 속성 설정
    const positionLocation = gl.getAttribLocation(shaderProgram, "a_position");
    const colorLocation = gl.getUniformLocation(shaderProgram, "u_color");

    // 스타일 설정
    const style = {
      pointColor: [1.0, 0.0, 0.0, 1.0],  // 빨간색
      lineColor: [0.0, 1.0, 0.0, 1.0],   // 초록색
      lineWidth: 2,
      dashPattern: [5, 5]  // 대시 패턴
    };

    // GeoJSON 데이터
    const geojson = {
      type: "FeatureCollection",
      features: [
        {
          type: "Feature",
          geometry: {
            type: "Point",
            coordinates: [0, 0]
          }
        },
        {
          type: "Feature",
          geometry: {
            type: "LineString",
            coordinates: [
              [-0.5, 0],
              [0.5, 0]
            ]
          }
        },
        {
          type: "Feature",
          geometry: {
            type: "Polygon",
            coordinates: [
              [
                [-0.5, -0.5],
                [0.5, -0.5],
                [0.5, 0.5],
                [-0.5, 0.5],
                [-0.5, -0.5]
              ]
            ]
          }
        }
      ]
    };

    // 그리기 함수
    function drawGeoJSON(geojson, style) {
      geojson.features.forEach(feature => {
        if (feature.geometry.type === "Point") {
          drawPoint(feature.geometry.coordinates, style);
        } else if (feature.geometry.type === "LineString") {
          drawLine(feature.geometry.coordinates, style);
        } else if (feature.geometry.type === "Polygon") {
          drawPolygon(feature.geometry.coordinates[0], style);
        }
      });
    }

    // 점 그리기
    function drawPoint(coordinates, style) {
      const buffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
      const vertices = new Float32Array([coordinates[0], coordinates[1]]);
      gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
      gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);
      gl.enableVertexAttribArray(positionLocation);
      gl.uniform4fv(colorLocation, style.pointColor);
      gl.drawArrays(gl.POINTS, 0, 1);
    }

    // 선 그리기
    function drawLine(coordinates, style) {
      const buffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
      const vertices = new Float32Array(coordinates.flat());
      gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
      gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);
      gl.enableVertexAttribArray(positionLocation);
      gl.uniform4fv(colorLocation, style.lineColor);
      gl.lineWidth(style.lineWidth);
      gl.drawArrays(gl.LINES, 0, coordinates.length);
    }

    // 다각형 그리기
    function drawPolygon(coordinates, style) {
      const buffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
      const vertices = new Float32Array(coordinates.flat());
      gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
      gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);
      gl.enableVertexAttribArray(positionLocation);
      gl.uniform4fv(colorLocation, style.lineColor);
      gl.drawArrays(gl.TRIANGLE_FAN, 0, coordinates.length);
    }

    // GeoJSON 그리기
    drawGeoJSON(geojson, style);
  </script>
</body>
</html>
