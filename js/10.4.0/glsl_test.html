<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoJSON WebGL</title>
</head>
<body>
    <canvas id="webglCanvas"></canvas>
    <script>
        const canvas = document.getElementById("webglCanvas");
        canvas.width = 800;
        canvas.height = 600;
        const gl = canvas.getContext("webgl");

        if (!gl) {
            alert("WebGL을 지원하지 않는 브라우저입니다.");
        }

        // GeoJSON 데이터 (예제)
        const geojson = {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [[
                            [-0.5, -0.5], [0.5, -0.5], [0.5, 0.5], 
                            [-0.5, -0.5], [0.5, 0.5], [-0.5, 0.5]
                        ]]
                    },
                    "properties": {"color": [1.0, 0.0, 0.0]}
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "LineString",
                        "coordinates": [[-0.8, 0.0], [0.8, 0.0]]
                    },
                    "properties": {"color": [0.0, 0.0, 1.0]}
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [0.0, 0.0]
                    },
                    "properties": {"color": [0.0, 1.0, 0.0]}
                }
            ]
        };

        const positions = [];
        const colors = [];
        const types = [];
        const dashPattern = [];
        const linewidth = [];

        geojson.features.forEach(feature => {
            const color = feature.properties.color;
            const geomType = feature.geometry.type;
            let coords = feature.geometry.coordinates;

            if (geomType === "Polygon") {
                coords[0].forEach(coord => {
                    positions.push(coord[0], coord[1]);
                    colors.push(color[0], color[1], color[2]);
                    types.push(0);
                    dashPattern.push(0.0);
                    linewidth.push(0.0);
                });
            } else if (geomType === "LineString") {
                for (let i = 0; i < coords.length - 1; i++) {
                    const [x1, y1] = coords[i];
                    const [x2, y2] = coords[i + 1];

                    positions.push(x1, y1, x2, y2, x2, y2);
                    colors.push(color[0], color[1], color[2], color[0], color[1], color[2], color[0], color[1], color[2]);
                    types.push(1, 1, 1);
                    dashPattern.push(0.2, 0.2, 0.2); // Dash 간격
                    linewidth.push(0.02, 0.02, 0.02); // 선 두께
                }
            } else if (geomType === "Point") {
                const size = 0.05;
                const x = coords[0], y = coords[1];

                positions.push(x, y + size, x - size, y - size, x + size, y - size);
                colors.push(color[0], color[1], color[2], color[0], color[1], color[2], color[0], color[1], color[2]);
                types.push(2, 2, 2);
                dashPattern.push(0.0, 0.0, 0.0);
                linewidth.push(0.0, 0.0, 0.0);
            }
        });

        function createBuffer(data, attribute, size) {
            const buffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data), gl.STATIC_DRAW);
            gl.enableVertexAttribArray(attribute);
            gl.vertexAttribPointer(attribute, size, gl.FLOAT, false, 0, 0);
        }

        // Vertex Shader
        const vertexShaderSource = `
            attribute vec2 a_position;
            attribute vec3 a_color;
            attribute float a_type;
            attribute float a_dashPattern;
            attribute float a_lineWidth;
            varying vec3 v_color;
            varying float v_dashPattern;
            varying float v_lineWidth;
            void main() {
                gl_Position = vec4(a_position, 0.0, 1.0);
                v_color = a_color;
                v_dashPattern = a_dashPattern;
                v_lineWidth = a_lineWidth;
            }
        `;

        // Fragment Shader
        const fragmentShaderSource = `
            precision mediump float;
            varying vec3 v_color;
            varying float v_dashPattern;
            varying float v_lineWidth;
            void main() {
                if (v_dashPattern > 0.0) {
                    float d = mod(gl_FragCoord.x, v_dashPattern * 20.0);
                    if (d > v_dashPattern * 10.0) discard;
                }
                gl_FragColor = vec4(v_color, 1.0);
            }
        `;

        function createShader(gl, type, source) {
            const shader = gl.createShader(type);
            gl.shaderSource(shader, source);
            gl.compileShader(shader);
            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                console.error("Shader compile error: ", gl.getShaderInfoLog(shader));
                gl.deleteShader(shader);
                return null;
            }
            return shader;
        }

        const vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexShaderSource);
        const fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSource);
        const program = gl.createProgram();
        gl.attachShader(program, vertexShader);
        gl.attachShader(program, fragmentShader);
        gl.linkProgram(program);
        gl.useProgram(program);

        const positionAttribute = gl.getAttribLocation(program, "a_position");
        const colorAttribute = gl.getAttribLocation(program, "a_color");
        const typeAttribute = gl.getAttribLocation(program, "a_type");
        const dashPatternAttribute = gl.getAttribLocation(program, "a_dashPattern");
        const lineWidthAttribute = gl.getAttribLocation(program, "a_lineWidth");

        createBuffer(positions, positionAttribute, 2);
        createBuffer(colors, colorAttribute, 3);
        createBuffer(types, typeAttribute, 1);
        createBuffer(dashPattern, dashPatternAttribute, 1);
        createBuffer(linewidth, lineWidthAttribute, 1);

        function render() {
            gl.clearColor(0.0, 0.0, 0.0, 1.0);
            gl.clear(gl.COLOR_BUFFER_BIT);
            gl.drawArrays(gl.TRIANGLES, 0, positions.length / 2);
        }

        render();
    </script>
</body>
</html>
