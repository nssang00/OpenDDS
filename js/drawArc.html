<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Donut Arc from VALNMR (optimized)</title>
  <style>
    html, body { margin:0; padding:0; background:#fff; }
    canvas { display:block; margin:12px; border:1px solid #ddd; }
  </style>
</head>
<body>
  <canvas id="canvas" width="640" height="480"></canvas>

  <script>
const COLORS = [
  "#FFFFFF", "#FFFF00", "#FF0000", "#00FF00",
  "#0000FF", "#FFA500", "#FF00FF", "#00FFFF"
];


function drawArc(sectr1, sectr2, valnmrNm, colorIndex = 0) {
  const MIN_NM = 0,  MAX_NM = 25;   // VALNMR 범위(예시)
  const MIN_R  = 10, MAX_R  = 120;  // px 반경(예시)
  const THICKNESS = 5;              // 도넛 두께(px, 고정)
  const SPOKE_LEN = 100;            // 점선 길이(px, 고정)

  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const cx = canvas.width / 2;
  const cy = canvas.height / 2;

  const nm = Math.max(MIN_NM, Math.min(MAX_NM, valnmrNm || 0));
  const t  = Math.sqrt((nm - MIN_NM) / (MAX_NM - MIN_NM || 1));
  const outerRadius = MIN_R + t * (MAX_R - MIN_R);
  const innerRadius = Math.max(1, outerRadius - THICKNESS);

  const toRad = deg => (deg - 270) * Math.PI / 180;
  const start = toRad(sectr1);
  const end   = toRad(sectr2);
  
  ctx.beginPath();
  ctx.arc(cx, cy, outerRadius, start, end);
  ctx.arc(cx, cy, innerRadius, end, start, true);
  ctx.closePath();

  ctx.fillStyle = COLORS[(colorIndex|0) % COLORS.length];
  ctx.fill();
  ctx.strokeStyle = 'black';
  ctx.lineWidth = 1;
  ctx.stroke();

  const cs = Math.cos(start), sn = Math.sin(start);
  const ce = Math.cos(end),   se = Math.sin(end);

  ctx.setLineDash([5, 2]);
  ctx.beginPath();
  ctx.moveTo(cx, cy);
  ctx.lineTo(cx + cs * SPOKE_LEN, cy + sn * SPOKE_LEN);
  ctx.moveTo(cx, cy);
  ctx.lineTo(cx + ce * SPOKE_LEN, cy + se * SPOKE_LEN);
  ctx.stroke();

  return canvas.toDataURL('image/png');
}

const url = drawArc(207, 176, 5, 2);
console.log(url);
  </script>
</body>
</html>
