<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Donut Arc (centered transparent PNG)</title>
</head>
<body>
  <div id="result"></div>

  <script>
const COLORS = [
  "#FFFFFF", "#FFFF00", "#FF0000", "#00FF00",
  "#0000FF", "#FFA500", "#FF00FF", "#00FFFF"
];

function drawArcCenteredPNG(sectr1, sectr2, valnmrNm, colorIndex = 0) {
  const minNM = 0,  maxNM = 25;        // VALNMR 범위(예시)
  const minRadius = 10, maxRadius = 120;  // px 반경(예시)
  const arcWidth  = 5;                 // 도넛(호) 두께
  const LINE_WIDTH = 1;
  const vectorLen  = 100;              // 벡터 길이(px, 고정) 

  // nm → 반경
  const nm = Math.max(minNM, Math.min(maxNM, valnmrNm ?? 0));
  const t  = Math.sqrt((nm - minNM) / Math.max(1e-6, (maxNM - minNM)));
  const outerRadius = minRadius + t * (maxRadius - minRadius);
  const innerRadius = Math.max(1, outerRadius - arcWidth);

  const toRad = deg => (deg - 270) * Math.PI / 180;
  const startAngle = toRad(sectr1);
  const endAngle   = toRad(sectr2);

  // 벡터 끝점 좌표 (중심 기준)
  const startVector = { x: Math.cos(startAngle) * vectorLen, y: Math.sin(startAngle) * vectorLen };
  const endVector   = { x: Math.cos(endAngle)   * vectorLen, y: Math.sin(endAngle)   * vectorLen };

  // 바운딩 박스: 외접원 + 벡터 끝점
  const r = outerRadius;
  let minX = Math.min(-r, startVector.x, endVector.x);
  let maxX = Math.max( r, startVector.x, endVector.x);
  let minY = Math.min(-r, startVector.y, endVector.y);
  let maxY = Math.max( r, startVector.y, endVector.y);

  const pad = Math.ceil(LINE_WIDTH / 2) + 1;
  const width  = Math.ceil((maxX - minX) + pad * 2);
  const height = Math.ceil((maxY - minY) + pad * 2);

  const canvas = document.createElement('canvas');
  canvas.width  = Math.floor(width);
  canvas.height = Math.floor(height);

  const ctx = canvas.getContext('2d');
  ctx.translate(width/2, height/2);

  // 도넛 섹터
  ctx.beginPath();
  ctx.arc(0, 0, outerRadius, startAngle, endAngle);
  ctx.arc(0, 0, innerRadius, endAngle, startAngle, true);
  ctx.closePath();

  ctx.fillStyle = COLORS[(colorIndex|0) % COLORS.length];
  ctx.fill();
  ctx.strokeStyle = 'black';
  ctx.lineWidth = LINE_WIDTH;
  ctx.stroke();

  // 벡터 (점선)
  ctx.setLineDash([5, 2]);
  ctx.beginPath();
  ctx.moveTo(0, 0);
  ctx.lineTo(startVector.x, startVector.y);
  ctx.moveTo(0, 0);
  ctx.lineTo(endVector.x, endVector.y);
  ctx.stroke();

  return canvas.toDataURL("image/png");
}

const url = drawArcCenteredPNG(207, 176, 5, 2);
const img = document.createElement("img");
img.src = url;
document.getElementById("result").appendChild(img);
  </script>
</body>
</html>
