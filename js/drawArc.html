<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Donut Arc from VALNMR</title>
</head>
<body>
  <canvas id="canvas" width="640" height="480"></canvas>

  <script>
    
const S52_LIGHT_COLORS = [
  "#FFFFFF", // 0 WHITE
  "#FFFF00", // 1 YELLOW
  "#FF0000", // 2 RED
  "#00FF00", // 3 GREEN
  "#0000FF", // 4 BLUE
  "#FFA500", // 5 ORANGE
  "#FF00FF", // 6 MAGENTA
  "#00FFFF"  // 7 CYAN
];    

function nmToRadius(nm) {
  const minNm=0, maxNm=25, minR=30, maxR=120;
  const clamped = Math.max(minNm, Math.min(maxNm, nm ?? 0));
  const t = Math.sqrt((clamped - minNm) / Math.max(1e-6, (maxNm - minNm)));
  return minR + t * (maxR - minR);
}    

function drawArc(sectr1, sectr2, valnmrNm, colorIndex) {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const cx = canvas.width / 2;
  const cy = canvas.height / 2;

  const thickness = 5; 
  const spokeLen  = 100;  // 점선 길이(px)

  // 외경/내경 계산
  const outerRadius = nmToRadius(valnmrNm);
  const innerRadius = Math.max(1, outerRadius - thickness);

  // 각도 변환 (12시=180° → Canvas 라디안)
  const toRad = deg => (deg - 270) * Math.PI / 180;
  const start = toRad(sectr1);
  const end   = toRad(sectr2);

  ctx.beginPath();
  ctx.arc(cx, cy, outerRadius, start, end);        // 바깥 호
  ctx.arc(cx, cy, innerRadius, end, start, true);  // 안쪽 호 (반대 방향)
  ctx.closePath();

  const fillColor = S52_LIGHT_COLORS[(colorIndex|0) % S52_LIGHT_COLORS.length];
  ctx.fillStyle = fillColor;
  ctx.fill();
  ctx.strokeStyle = 'black';
  ctx.lineWidth = 1;
  ctx.stroke();

  // 점선 경계 (항상 일정 길이)
  ctx.setLineDash([5, 2]);
  ctx.beginPath();
  ctx.moveTo(cx, cy);
  ctx.lineTo(cx + Math.cos(start) * spokeLen, cy + Math.sin(start) * spokeLen);
  ctx.moveTo(cx, cy);
  ctx.lineTo(cx + Math.cos(end) * spokeLen, cy + Math.sin(end) * spokeLen);
  ctx.stroke();

  return canvas.toDataURL('image/png');
}


const url = drawArc(207, 176, 4, 2);
console.log(url);
  </script>
</body>
</html>
