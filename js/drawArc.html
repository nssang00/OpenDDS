<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Donut Arc (centered transparent PNG)</title>
</head>
<body>
  <div id="result"></div>

  <script>
const COLORS = [
  "#FFFFFF", "#FFFF00", "#FF0000", "#00FF00",
  "#0000FF", "#FFA500", "#FF00FF", "#00FFFF"
];

function drawArcCenteredPNG(sectr1, sectr2, valnmrNm, colorIndex = 0) {
  const MIN_NM = 0,  MAX_NM = 25;   // VALNMR 범위(예시)
  const MIN_R  = 10, MAX_R  = 120;  // px 반경(예시)
  const THICKNESS = 5;              // 도넛 두께
  const LINE_WIDTH = 1;
  const spokeLen = 100;             // 점선 길이(px, 고정) 

  // nm → 반경
  const nm = Math.max(MIN_NM, Math.min(MAX_NM, valnmrNm ?? 0));
  const t  = Math.sqrt((nm - MIN_NM) / Math.max(1e-6, (MAX_NM - MIN_NM)));
  const outerRadius = MIN_R + t * (MAX_R - MIN_R);
  const innerRadius = Math.max(1, outerRadius - THICKNESS);

  const toRad = deg => (deg - 270) * Math.PI / 180;
  const startAngle = toRad(sectr1);
  const endAngle   = toRad(sectr2);

  // 스포크 끝점 좌표 (중심 기준)
  const spoke1 = { x: Math.cos(startAngle) * spokeLen, y: Math.sin(startAngle) * spokeLen };
  const spoke2 = { x: Math.cos(endAngle)   * spokeLen, y: Math.sin(endAngle)   * spokeLen };

  // 바운딩 박스: 외접원 + 스포크 끝점
  const r = outerRadius;
  let minX = Math.min(-r, spoke1.x, spoke2.x);
  let maxX = Math.max( r, spoke1.x, spoke2.x);
  let minY = Math.min(-r, spoke1.y, spoke2.y);
  let maxY = Math.max( r, spoke1.y, spoke2.y);

  const pad = Math.ceil(LINE_WIDTH / 2) + 1;
  const width  = Math.ceil((maxX - minX) + pad * 2);
  const height = Math.ceil((maxY - minY) + pad * 2);

  const canvas = document.createElement('canvas');
  canvas.width  = Math.floor(width);
  canvas.height = Math.floor(height);

  const ctx = canvas.getContext('2d');
  ctx.translate(width/2, height/2);

  // 도넛 섹터
  ctx.beginPath();
  ctx.arc(0, 0, outerRadius, startAngle, endAngle);
  ctx.arc(0, 0, innerRadius, endAngle, startAngle, true);
  ctx.closePath();

  ctx.fillStyle = COLORS[(colorIndex|0) % COLORS.length];
  ctx.fill();
  ctx.strokeStyle = 'black';
  ctx.lineWidth = LINE_WIDTH;
  ctx.stroke();

  // 스포크
  ctx.setLineDash([5, 2]);
  ctx.beginPath();
  ctx.moveTo(0, 0);
  ctx.lineTo(spoke1.x, spoke1.y);
  ctx.moveTo(0, 0);
  ctx.lineTo(spoke2.x, spoke2.y);
  ctx.stroke();

  return canvas.toDataURL("image/png");
}

const url = drawArcCenteredPNG(207, 176, 5, 2);
const img = document.createElement("img");
img.src = url;
document.getElementById("result").appendChild(img);
  </script>
</body>
</html>
