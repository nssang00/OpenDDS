$interval = 10  # 기록 간격(초)
$logFile = "C:\system_monitoring_log.txt"  # 로그 파일 경로

while ($true) {
    $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    
    # 측정 샘플 수
    $sampleCount = 10
    $totalCpuUsage = 0

    for ($i = 0; $i -lt $sampleCount; $i++) {
        $cpuCounter = Get-Counter '\Processor(_Total)\% Processor Time'
        $totalCpuUsage += $cpuCounter.CounterSamples.CookedValue
        Start-Sleep -Milliseconds 100  # 짧은 주기로 측정
    }

    # 평균 CPU 사용량 계산
    $averageCpuUsage = [math]::round($totalCpuUsage / $sampleCount, 2)
    
    # 전체 메모리 사용량
    $osInfo = Get-WmiObject Win32_OperatingSystem
    $totalMemoryMB = [math]::round($osInfo.TotalVisibleMemorySize / 1MB, 2)
    $freeMemoryMB = [math]::round($osInfo.FreePhysicalMemory / 1MB, 2)
    $usedMemoryMB = $totalMemoryMB - $freeMemoryMB
    
    # 메모리 사용량 퍼센트 계산
    if ($totalMemoryMB -gt 0) {
        $memoryUsagePercent = [math]::round(($usedMemoryMB / $totalMemoryMB) * 100, 2)
    } else {
        $memoryUsagePercent = 0
    }

    # 로그 항목 작성
    $logEntry = "$timestamp - CPU Usage: $averageCpuUsage%, Memory Usage: $memoryUsagePercent% ($usedMemoryMB MB / $totalMemoryMB MB)"
    
    # 로그 파일에 기록
    Add-Content -Path $logFile -Value $logEntry
    
    # 콘솔에 출력
    Write-Host $logEntry
    
    # 지정된 간격만큼 대기
    Start-Sleep -Seconds $interval
}
