$processName = "subprocess.exe"  # 모니터링할 프로세스 이름
$interval = 10                   # 기록 간격(초)
$logFile = "C:\process_monitoring_log.txt"  # 로그 파일 경로

while ($true) {
    $processes = Get-Process -Name $processName -ErrorAction SilentlyContinue
    
    if ($processes) {
        foreach ($process in $processes) {
            $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
            $pid = $process.Id
            $cpuUsage = $process | Measure-Object -Property CPU -Sum | Select-Object -ExpandProperty Sum
            $memoryUsage = [math]::round(($process.WorkingSet / 1MB), 2)
            
            $logEntry = "$timestamp - PID: $pid, Process: $processName, CPU Usage: $cpuUsage, Memory Usage: $memoryUsage MB"
            
            # 로그 파일에 기록
            Add-Content -Path $logFile -Value $logEntry
            
            # 콘솔에 출력
            Write-Host $logEntry
        }
    } else {
        $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
        $logEntry = "$timestamp - Process $processName not found"
        
        # 로그 파일에 기록
        Add-Content -Path $logFile -Value $logEntry
        
        # 콘솔에 출력
        Write-Host $logEntry
    }
    
    Start-Sleep -Seconds $interval
}
