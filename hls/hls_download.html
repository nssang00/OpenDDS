<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HLS.js Video Recording</title>
</head>
<body>

    <video id="video" controls autoplay></video>
    <button id="saveButton">Save Video</button>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        const video = document.getElementById('video');
        const saveButton = document.getElementById('saveButton');
        let recordedChunks = [];

        if (Hls.isSupported()) {
            const hls = new Hls();

            // HLS 스트림 로드
            hls.loadSource('https://path-to-hls-stream.m3u8');  // 스트림 URL 설정
            hls.attachMedia(video);
            
            hls.on(Hls.Events.MEDIA_ATTACHED, function () {
                console.log('Video and HLS.js are now bound together!');
                video.play();
            });

            // 각 세그먼트 데이터를 저장하는 이벤트 리스너
            hls.on(Hls.Events.FRAG_PARSING_DATA, function (event, data) {
                if (data.type === 'audio' || data.type === 'video') {
                    recordedChunks.push(data.data);
                }
            });
        }

        // 저장 버튼 클릭 시 Blob을 이용해 비디오 다운로드
        saveButton.addEventListener('click', function () {
            if (recordedChunks.length) {
                const blob = new Blob(recordedChunks, { type: 'video/mp4' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = 'recorded-video.mp4';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                console.log('Video saved successfully.');
            } else {
                console.log('No video data recorded.');
            }
        });
    </script>

</body>
</html>
